# Import the Azure PowerShell module
Import-Module Az

# Connect to Azure using Azure Run As account
Connect-AzAccount -Identity

# Define an array of VMs and their specific resource groups
$VMResourcePairs = @(
    @{"VMName"="vm1"; "ResourceGroup"="rg1"},
    @{"VMName"="vm2"; "ResourceGroup"="rg2"},
    @{"VMName"="vm3"; "ResourceGroup"="rg2"},
    @{"VMName"="vm4"; "ResourceGroup"="rg3"}
)

# Loop through the array and stop each VM
foreach ($pair in $VMResourcePairs) {
    $VMName = $pair["VMName"]
    $ResourceGroupName = $pair["ResourceGroup"]

    Write-Output "Stopping VM $VMName in resource group $ResourceGroupName"

    # Stop the VM
    Stop-AzVM -Name $VMName -ResourceGroupName $ResourceGroupName -Force
}
